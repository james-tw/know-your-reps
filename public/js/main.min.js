!function(){function e(e){e.when("/:stateId",{templateUrl:"partials/rep-list.html",controller:"ListCtrl"}).when("/rep/:repId",{templateUrl:"partials/rep-detail.html",controller:"ListCtrl"}).when("/",{templateUrl:"partials/rep-list.html",controller:"ListCtrl"}).otherwise({redirectTo:"/"})}function t(e,t){function r(e){return h[e]}function n(){return h}function o(e){var t,r=e.split(" ");return("Jr"===r[r.length-1]||"Sr"===r[r.length-1])&&(t=r.pop()),r=r.join(" ").split(",").reverse(),t.length&&r.push(t),r.join(" ").trim()}function i(e){return"S"===e.charAt(2)?"Sen.":"Rep."}function a(e){return parseInt(e.slice(2,4),10)}function s(e){return"H"===e?"Representative":"S"===e?"Senator":void 0}function c(e){return"R"===e?"Republican":"D"===e?"Democrat":"Independent"}function l(r){var n=t.defer();return e({method:"GET",url:"http://crossorigin.me/http://www.opensecrets.org/api/?method=getLegislators&output=json&id="+r+"&apikey="+d,cache:!0}).success(function(e){var t=e.response.legislator,r=[];angular.forEach(t,function(e){var t={};e=e["@attributes"],t.party=e.party,t.office=i(e.office),t.fullName=e.firstlast,t.district=a(e.office),t.phone=e.phone,t.website=e.website,t.cid=e.cid,r.push(t)}),n.resolve(r)}).error(function(e,t){n.reject(e)}),n.promise}function u(r){var n=t.defer();return e({method:"GET",url:"http://crossorigin.me/http://www.opensecrets.org/api/?method=candSummary&output=json&cid="+r+"&apikey="+d,cache:!0}).success(function(e){var t=e.response.summary["@attributes"],r={};r.fullName=o(t.cand_name),r.state=t.state,r.party=t.party,r.partyFull=c(t.party),r.cycle=t.cycle,r.chamber=s(t.chamber),r.total=t.total,r.spent=t.spent,r.cashOnHand=t.cash_on_hand,r.debt=t.debt,n.resolve(r)}).error(function(e,t){console.log(e),n.reject(e)}),n.promise}function p(r){var n=t.defer();return e({method:"GET",url:"http://crossorigin.me/http://www.opensecrets.org/api/?method=candIndustry&output=json&cid="+r+"&apikey="+d,cache:!0}).success(function(e){var t=e.response.industries.industry,r=[];angular.forEach(t,function(e){var t={};e=e["@attributes"],t.name=e.industry_name,t.indivs=e.indivs,t.pacs=e.pacs,t.total=e.total,r.push(t)}),n.resolve(r)}).error(function(e,t){console.log(e),n.reject(e)}),n.promise}var d="e083ad78821ccd23756c34c26b0713ff",h={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"};return{getRepsByState:l,getRepSummary:u,getRepIndustry:p,getStateName:r,getStates:n}}function r(e,t){function r(){var e=t.defer();return navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){a.splice(0,a.length),a.push(t.coords.latitude.toFixed(2)),a.push(t.coords.longitude.toFixed(2)),o().then(function(){e.resolve()})},function(t){3===t.code&&alert("Couldn't find your location in a reasonable amount of time. Try using your ZIP code."),t.code===t.PERMISSION_DENIED&&e.reject("declined"),e.reject()},{timeout:5e3,maximumAge:6e4}),e.promise}function n(e){var r=t.defer();return a.splice(0,a.length),a.push(e),o().then(function(){r.resolve()},function(e){r.reject()}),r.promise}function o(){var r,n=t.defer();return r=2===a.length?"latitude="+a[0]+"&longitude="+a[1]:"zip="+a[0],e({method:"GET",url:"http://congress.api.sunlightfoundation.com/legislators/locate?"+r+"&apikey="+i,cache:!0}).success(function(e){if(e.results.length){var t=e.results;s.splice(0,s.length),c[0]=t[0].state,angular.forEach(t,function(e){null!==e.district&&s.push(parseInt(e.district))}),n.resolve()}else alert("Please enter a valid ZIP code"),n.reject()}).error(function(e,t){n.reject()}),n.promise}var i="49bc7837f5f649c5b0e70b55e84cc722",a=[],s=[],c=[];return{getDistrict:o,submitZip:n,geolocate:r,myDistricts:s,myState:c}}function n(){var e=this;return e.localStoreSupport=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},e.set=function(e,t,r){if(r){var n=new Date;n.setTime(n.getTime()+24*r*60*60*1e3);var o="; expires="+n.toGMTString()}else var o="";return this.localStoreSupport()?localStorage.setItem(e,t):document.cookie=e+"="+t+o+"; path=/",t},e.get=function(e){if(this.localStoreSupport())return localStorage.getItem(e);for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null},e.del=function(e){this.localStoreSupport()?localStorage.removeItem(e):this.set(e,"",-1)},e}FastClick.attach(document.body);angular.module("knowYourReps",["ngRoute"]).directive("pageHeader",pageHeader).directive("pageFooter",pageFooter).directive("mapWidget",mapWidget).directive("repList",repList).directive("repPanel",repPanel).directive("repDetailIndustry",repDetailIndustry).directive("onEnter",onEnter).factory("openSecrets",t).factory("locationService",r).factory("cacheService",n).controller("ListCtrl",ListCtrl).controller("MapCtrl",MapCtrl).config(e);e.$inject=["$routeProvider"],t.$inject=["$http","$q"],r.$inject=["$http","$q"]}();
function ListCtrl(t,e,i,s,c,n,r){function a(t){var e=r.get(t);return e?(e=e.split(","),"districts"===t?e.map(function(t,e,i){return parseInt(t)}):e):[]}function o(){t.geolocatingInProgress=!0,n.geolocate().then(function(){t.myDistricts=n.myDistricts,t.myState=n.myState,t.cachedDistricts=r.set("districts",t.myDistricts.join(",")),t.cachedState=r.set("state",t.myState.join(",")),y()},function(t){})["finally"](function(){t.geolocatingInProgress=!1})}function u(e){t.ziplocatingInProgress=!0,n.submitZip(e).then(function(){t.myDistricts=n.myDistricts,t.myState=n.myState,t.cachedDistricts=r.set("districts",t.myDistricts.join(",")),t.cachedState=r.set("state",t.myState.join(",")),y()},function(t){})["finally"](function(){t.ziplocatingInProgress=!1})}function y(){t.state=t.myState[0]}function l(){t.myDistricts.splice(0,t.myDistricts.length),t.myState.splice(0,t.myState.length)}function m(){r.del("districts"),r.del("state"),t.cachedDistricts=[],t.cachedState=[]}function p(e){return-1===t.myDistricts.indexOf(e.district)&&t.myState[0]===t.state}function f(e){return(!p(e)||"Sen."===e.office)&&t.myState[0]===t.state}t.states=c.getStates(),t.state=i.stateId,t.reps=[],t.rep={},t.repIndustries=[],t.clearCache=m,t.cachedDistricts=a("districts"),t.cachedState=a("state"),t.isMyDistrict=p,t.isMyRep=f,t.submitZip=u,t.geolocate=o,t.getDistrict=n.getDistrict,t.myDistricts=n.myDistricts.length?n.myDistricts:t.cachedDistricts||[],t.myState=n.myState.length?n.myState:t.cachedState||[],t.clearMyLocation=l,t.showMyState=y,i.repId&&(window.scrollTo(0,0),c.getRepSummary(i.repId).then(function(e){t.rep=e}),c.getRepIndustry(i.repId).then(function(e){t.repIndustries=e})),t.$watch("state",function(e){"undefined"!=typeof e&&(t.reps.splice(0,t.reps.length),self.stateName=c.getStateName(e),c.getRepsByState(e).then(function(e){t.reps=e}),s.path("/"+e))});var d=e.current;t.$on("$locationChangeSuccess",function(t,i,s){-1===s.indexOf("/rep/")&&-1===i.indexOf("/rep/")&&(e.current=d)})}function MapCtrl(t){t.$watch("state",function(t){$("[data-hit="+t+"]").trigger("colorize",[t])})}ListCtrl.$inject=["$scope","$route","$routeParams","$location","openSecrets","locationService","cacheService"],MapCtrl.$inject=["$scope"];
function pageHeader(){return{restrict:"EA",templateUrl:"partials/page-header.html",replace:!0}}function pageFooter(){return{restrict:"EA",templateUrl:"partials/page-footer.html",replace:!0}}function repList(){return{restrict:"EA",templateUrl:"partials/rep-list.html",replace:!0}}function repPanel(){return{restrict:"EA",templateUrl:"partials/rep-panel.html",replace:!0}}function repDetailIndustry(){return{restrict:"EA",templateUrl:"partials/rep-detail-industry.html",replace:!0}}function mapWidget(t){return{restrict:"EA",templateUrl:"partials/map-widget.html",replace:!1,scope:{state:"="},link:function(e,r,l){$("#map").usmap({stateStyles:{fill:"#93C5DA"},stateHoverStyles:{fill:"#FFD6A8"},stateHoverAnimation:180,click:function(r,l){e.state=l.name,t(function(){e.$apply()}),$(this).trigger("colorize",[l.name])}}).on("colorize",function(t,e){$("#map > svg > path").each(function(){$(this).css("fill","")}),$("#"+e).css("fill","#FFD6A8")})},controller:"MapCtrl"}}function onEnter(){return function(t,e,r){e.bind("keyup",function(e){13===e.which&&(t.$apply(function(){t.$eval(r.onEnter)}),e.preventDefault())})}}mapWidget.$inject=["$timeout"];